(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/// <reference path="typings.d.ts" />
function main() {
    var params = parse(document.location.search);
    if (params.id == null || params.tip == null) {
        $('#loading').hide();
        creator.show();
        return;
    }
    var cookie = getCookie();
    if (cookie.ip == null || cookie.port == null) {
        $('#loading').hide();
        setting.show(params);
        return;
    }
    var latest = cookie.latest;
    if (latest != null
        && latest.id === params.id
        && latest.tip === params.tip
        && latest.date > Date.now() - 15 * 1000 // 同じチャンネルに再アクセスした時は設定をやり直す
    ) {
        $('#loading').hide();
        setting.show(params);
        return;
    }
    everyTime.show(cookie, params);
}
var creator;
(function (creator) {
    function show() {
        $('#creator').show();
        $('#creator-streamURL').bind('input', function () {
            var a = /http:\/\/([0-9]+\.[0-9]+\.[0-9]+\.[0-9]+):([0-9]+)\/stream\/([0-9abcdef]+)/
                .exec($(this).val());
            if (a == null) {
                return;
            }
            var ip = toInt(a[1].split('.').map(function (x) { return Number.parseInt(x); }));
            if (isGlobalIP(ip)) {
                $('#creator-ip').val(a[1]);
            }
            $('#creator-id').val(a[3]);
            $('#creator-port').val(a[2]);
            updateURL();
        });
        $('#creator-id').bind('input', updateURL);
        $('#creator-ip').bind('input', updateURL);
        $('#creator-port').bind('input', updateURL);
        getIPs(function (ip) {
            if (isIPv4(ip) && isGlobalIP(toInt(ip.split('.').map(function (x) { return Number.parseInt(x); })))) {
                $('#creator-ip').val(ip);
                updateURL();
            }
        });
    }
    creator.show = show;
    function updateURL() {
        var url = location.href.replace(/\?.*/, "");
        var id = $('#creator-id').val() || '{チャンネルID}';
        var ip = $('#creator-ip').val() || '{IP}';
        var port = $('#creator-port').val() || '{ポート番号}';
        // $('#creator-output').val(`${url}?id=${id}&tip=${ip}:${port}`);
        $('#creator-output').val(url + "?");
    }
    function isGlobalIP(ip) {
        return !(toInt([10, 0, 0, 0]) <= ip && ip <= toInt([10, 255, 255, 255])
            || toInt([127, 0, 0, 0]) <= ip && ip <= toInt([127, 255, 255, 255])
            || toInt([169, 254, 0, 0]) <= ip && ip <= toInt([169, 254, 255, 255])
            || toInt([172, 16, 0, 0]) <= ip && ip <= toInt([172, 31, 255, 255])
            || toInt([192, 168, 0, 0]) <= ip && ip <= toInt([192, 168, 255, 255])
            || toInt([224, 0, 0, 0]) <= ip);
    }
    function isIPv4(ip) {
        return ip.match(/[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+/);
    }
    function toInt(ipArray) {
        return ipArray[0] * 0x1000000
            + ipArray[1] * 0x10000
            + ipArray[2] * 0x100
            + ipArray[3];
    }
})(creator || (creator = {}));
var setting;
(function (setting) {
    function show(params) {
        $('#setting').show();
        $('#setting-button').click(function () {
            $('#setting-info').show();
            var ip = $('#setting-ip').val();
            var port = Number.parseInt($('#setting-port').val());
            Cookies.set('ip', ip);
            Cookies.set('port', port);
            redirect(ip, port, params.id, params.tip);
        });
    }
    setting.show = show;
})(setting || (setting = {}));
var everyTime;
(function (everyTime) {
    function show(cookie, params) {
        redirect(cookie.ip, cookie.port, params.id, params.tip);
    }
    everyTime.show = show;
})(everyTime || (everyTime = {}));
function redirect(ip, port, id, tip) {
    Cookies.set('latest', JSON.stringify({ id: id, tip: tip, date: Date.now() }));
    var url = "http://" + ip + ":" + port + "/pls/" + id + "?tip=" + tip;
    $('.link').attr('href', url);
    $('#iframe').attr('src', url);
}
function parse(search) {
    var params = {};
    search.slice(1)
        .split('&')
        .map(function (x) { return x.split('='); })
        .forEach(function (x) {
        params[decodeURIComponent(x[0])] = decodeURIComponent(x[1]);
    });
    return params;
}
function getCookie() {
    return {
        ip: Cookies.get('ip'),
        port: Number.parseInt(Cookies.get('port')),
        latest: parseLatest(Cookies.get('latest'))
    };
}
function parseLatest(latest) {
    try {
        return JSON.parse(latest);
    }
    catch (e) {
        return null;
    }
}
var base64;
(function (base64_1) {
    var tableStr = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
    var table = tableStr.split("");
    function atob(base64) {
        if (/(=[^=]+|={3,})$/.test(base64))
            throw new Error("String contains an invalid character");
        base64 = base64.replace(/=/g, "");
        var n = base64.length & 3;
        if (n === 1)
            throw new Error("String contains an invalid character");
        for (var i = 0, j = 0, len = base64.length / 4, bin = []; i < len; ++i) {
            var a = tableStr.indexOf(base64[j++] || "A"), b = tableStr.indexOf(base64[j++] || "A");
            var c = tableStr.indexOf(base64[j++] || "A"), d = tableStr.indexOf(base64[j++] || "A");
            if ((a | b | c | d) < 0)
                throw new Error("String contains an invalid character");
            bin[bin.length] = ((a << 2) | (b >> 4)) & 255;
            bin[bin.length] = ((b << 4) | (c >> 2)) & 255;
            bin[bin.length] = ((c << 6) | d) & 255;
        }
        ;
        return String.fromCharCode.apply(null, bin).substr(0, bin.length + n - 4);
    }
    ;
    function btoa(bin) {
        for (var i = 0, j = 0, len = bin.length / 3, base64 = []; i < len; ++i) {
            var a = bin.charCodeAt(j++), b = bin.charCodeAt(j++), c = bin.charCodeAt(j++);
            if ((a | b | c) > 255)
                throw new Error("String contains an invalid character");
            base64[base64.length] = table[a >> 2] + table[((a << 4) & 63) | (b >> 4)] +
                (isNaN(b) ? "=" : table[((b << 2) & 63) | (c >> 6)]) +
                (isNaN(b + c) ? "=" : table[c & 63]);
        }
        return base64.join("");
    }
    ;
    function hexToBase64(str) {
        return btoa(String.fromCharCode.apply(null, str.replace(/\r|\n/g, "").replace(/([\da-fA-F]{2}) ?/g, "0x$1 ").replace(/ +$/, "").split(" ")));
    }
    base64_1.hexToBase64 = hexToBase64;
    function base64ToHex(str) {
        for (var i = 0, bin = atob(str.replace(/[ \r\n]+$/, "")), hex = []; i < bin.length; ++i) {
            var tmp = bin.charCodeAt(i).toString(16);
            if (tmp.length === 1)
                tmp = "0" + tmp;
            hex[hex.length] = tmp;
        }
        return hex.join(" ");
    }
    base64_1.base64ToHex = base64ToHex;
})(base64 || (base64 = {}));
main();
},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvcHVibGljL2pzL2FwcC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBLHFDQUFxQztBQWtCckM7SUFDSSxJQUFJLE1BQU0sR0FBWSxLQUFLLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUN0RCxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFBRSxJQUFJLElBQUksSUFBSSxNQUFNLENBQUMsR0FBRyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDMUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3JCLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNmLE1BQU0sQ0FBQztJQUNYLENBQUM7SUFDRCxJQUFJLE1BQU0sR0FBRyxTQUFTLEVBQUUsQ0FBQztJQUN6QixFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFBRSxJQUFJLElBQUksSUFBSSxNQUFNLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDM0MsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3JCLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDckIsTUFBTSxDQUFDO0lBQ1gsQ0FBQztJQUNELElBQUksTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUM7SUFDM0IsRUFBRSxDQUFDLENBQUMsTUFBTSxJQUFJLElBQUk7V0FDWCxNQUFNLENBQUMsRUFBRSxLQUFLLE1BQU0sQ0FBQyxFQUFFO1dBQ3ZCLE1BQU0sQ0FBQyxHQUFHLEtBQUssTUFBTSxDQUFDLEdBQUc7V0FDekIsTUFBTSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQywyQkFBMkI7SUFDdkUsQ0FB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QUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQztZQUM5QyxHQUFHLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUM7WUFDOUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQztRQUMzQyxDQUFDO1FBQUEsQ0FBQztRQUNGLE1BQU0sQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsTUFBTSxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUM5RSxDQUFDO0lBQUEsQ0FBQztJQUVGLGNBQWMsR0FBVztRQUNyQixHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsR0FBRyxHQUFHLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxNQUFNLEdBQWEsRUFBRSxFQUFFLENBQUMsR0FBRyxHQUFHLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQztZQUMvRSxJQUFJLENBQUMsR0FBRyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEdBQUcsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQzlFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUM7Z0JBQUMsTUFBTSxJQUFJLEtBQUssQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDO1lBQy9FLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztnQkFDekUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3BELENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxHQUFHLEdBQUcsS0FBSyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3pDLENBQUM7UUFDRCxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUMzQixDQUFDO0lBQUEsQ0FBQztJQUVGLHFCQUE0QixHQUFXO1FBQ25DLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUN0QyxHQUFHLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsb0JBQW9CLEVBQUUsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FDbEcsQ0FBQztJQUNOLENBQUM7SUFKZSxvQkFBVyxjQUkxQixDQUFBO0lBRUQscUJBQTRCLEdBQVc7UUFDbkMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLFdBQVcsRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUFFLEdBQUcsR0FBYSxFQUFFLEVBQUUsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQztZQUNoRyxJQUFJLEdBQUcsR0FBRyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUN6QyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQztnQkFBQyxHQUFHLEdBQUcsR0FBRyxHQUFHLEdBQUcsQ0FBQztZQUN0QyxHQUFHLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEdBQUcsQ0FBQztRQUMxQixDQUFDO1FBQ0QsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDekIsQ0FBQztJQVBlLG9CQUFXLGNBTzFCLENBQUE7QUFDTCxDQUFDLEVBN0NTLE1BQU0sS0FBTixNQUFNLFFBNkNmO0FBRUQsSUFBSSxFQUFFLENBQUMiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLy8vIDxyZWZlcmVuY2UgcGF0aD1cInR5cGluZ3MuZC50c1wiIC8+XHJcbmRlY2xhcmUgZnVuY3Rpb24gZ2V0SVBzKGNhbGxiYWNrOiAoaXA6IHN0cmluZykgPT4gdm9pZCk6IHZvaWQ7XHJcblxyXG5pbnRlcmZhY2UgQ2hhbm5lbCB7XHJcbiAgICBpZDogc3RyaW5nO1xyXG4gICAgdGlwOiBzdHJpbmc7XHJcbn1cclxuXHJcbmludGVyZmFjZSBDb29raWUge1xyXG4gICAgaXA6IHN0cmluZztcclxuICAgIHBvcnQ6IG51bWJlcjtcclxuICAgIGxhdGVzdDogTGF0ZXN0O1xyXG59XHJcblxyXG5pbnRlcmZhY2UgTGF0ZXN0IGV4dGVuZHMgQ2hhbm5lbCB7XHJcbiAgICBkYXRlOiBudW1iZXJcclxufVxyXG5cclxuZnVuY3Rpb24gbWFpbigpIHtcclxuICAgIGxldCBwYXJhbXMgPSA8Q2hhbm5lbD5wYXJzZShkb2N1bWVudC5sb2NhdGlvbi5zZWFyY2gpO1xyXG4gICAgaWYgKHBhcmFtcy5pZCA9PSBudWxsIHx8IHBhcmFtcy50aXAgPT0gbnVsbCkge1xyXG4gICAgICAgICQoJyNsb2FkaW5nJykuaGlkZSgpO1xyXG4gICAgICAgIGNyZWF0b3Iuc2hvdygpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGxldCBjb29raWUgPSBnZXRDb29raWUoKTtcclxuICAgIGlmIChjb29raWUuaXAgPT0gbnVsbCB8fCBjb29raWUucG9ydCA9PSBudWxsKSB7XHJcbiAgICAgICAgJCgnI2xvYWRpbmcnKS5oaWRlKCk7XHJcbiAgICAgICAgc2V0dGluZy5zaG93KHBhcmFtcyk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgbGV0IGxhdGVzdCA9IGNvb2tpZS5sYXRlc3Q7XHJcbiAgICBpZiAobGF0ZXN0ICE9IG51bGxcclxuICAgICAgICAmJiBsYXRlc3QuaWQgPT09IHBhcmFtcy5pZFxyXG4gICAgICAgICYmIGxhdGVzdC50aXAgPT09IHBhcmFtcy50aXBcclxuICAgICAgICAmJiBsYXRlc3QuZGF0ZSA+IERhdGUubm93KCkgLSAxNSAqIDEwMDAgLy8g5ZCM44GY44OB44Oj44Oz44ON44Or44Gr5YaN44Ki44Kv44K744K544GX44Gf5pmC44Gv6Kit5a6a44KS44KE44KK55u044GZXHJcbiAgICApIHtcclxuICAgICAgICAkKCcjbG9hZGluZycpLmhpZGUoKTtcclxuICAgICAgICBzZXR0aW5nLnNob3cocGFyYW1zKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBldmVyeVRpbWUuc2hvdyhjb29raWUsIHBhcmFtcyk7XHJcbn1cclxuXHJcbm5hbWVzcGFjZSBjcmVhdG9yIHtcclxuICAgIGV4cG9ydCBmdW5jdGlvbiBzaG93KCkge1xyXG4gICAgICAgICQoJyNjcmVhdG9yJykuc2hvdygpO1xyXG5cclxuICAgICAgICAkKCcjY3JlYXRvci1zdHJlYW1VUkwnKS5iaW5kKCdpbnB1dCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBsZXQgYSA9IC9odHRwOlxcL1xcLyhbMC05XStcXC5bMC05XStcXC5bMC05XStcXC5bMC05XSspOihbMC05XSspXFwvc3RyZWFtXFwvKFswLTlhYmNkZWZdKykvXHJcbiAgICAgICAgICAgICAgICAuZXhlYygkKHRoaXMpLnZhbCgpKTtcclxuICAgICAgICAgICAgaWYgKGEgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxldCBpcCA9IHRvSW50KGFbMV0uc3BsaXQoJy4nKS5tYXAoeCA9PiBOdW1iZXIucGFyc2VJbnQoeCkpKTtcclxuICAgICAgICAgICAgaWYgKGlzR2xvYmFsSVAoaXApKSB7XHJcbiAgICAgICAgICAgICAgICAkKCcjY3JlYXRvci1pcCcpLnZhbChhWzFdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAkKCcjY3JlYXRvci1pZCcpLnZhbChhWzNdKTtcclxuICAgICAgICAgICAgJCgnI2NyZWF0b3ItcG9ydCcpLnZhbChhWzJdKTtcclxuICAgICAgICAgICAgdXBkYXRlVVJMKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICQoJyNjcmVhdG9yLWlkJykuYmluZCgnaW5wdXQnLCB1cGRhdGVVUkwpO1xyXG4gICAgICAgICQoJyNjcmVhdG9yLWlwJykuYmluZCgnaW5wdXQnLCB1cGRhdGVVUkwpO1xyXG4gICAgICAgICQoJyNjcmVhdG9yLXBvcnQnKS5iaW5kKCdpbnB1dCcsIHVwZGF0ZVVSTCk7XHJcblxyXG4gICAgICAgIGdldElQcygoaXA6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgICBpZiAoaXNJUHY0KGlwKSAmJiBpc0dsb2JhbElQKHRvSW50KGlwLnNwbGl0KCcuJykubWFwKHggPT4gTnVtYmVyLnBhcnNlSW50KHgpKSkpKSB7XHJcbiAgICAgICAgICAgICAgICAkKCcjY3JlYXRvci1pcCcpLnZhbChpcCk7XHJcbiAgICAgICAgICAgICAgICB1cGRhdGVVUkwoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHVwZGF0ZVVSTCgpIHtcclxuICAgICAgICBsZXQgdXJsID0gbG9jYXRpb24uaHJlZi5yZXBsYWNlKC9cXD8uKi8sIFwiXCIpO1xyXG4gICAgICAgIGxldCBpZCA9ICQoJyNjcmVhdG9yLWlkJykudmFsKCkgfHwgJ3vjg4Hjg6Pjg7Pjg43jg6tJRH0nO1xyXG4gICAgICAgIGxldCBpcCA9ICQoJyNjcmVhdG9yLWlwJykudmFsKCkgfHwgJ3tJUH0nO1xyXG4gICAgICAgIGxldCBwb3J0ID0gJCgnI2NyZWF0b3ItcG9ydCcpLnZhbCgpIHx8ICd744Od44O844OI55Wq5Y+3fSc7XHJcbiAgICAgICAgLy8gJCgnI2NyZWF0b3Itb3V0cHV0JykudmFsKGAke3VybH0/aWQ9JHtpZH0mdGlwPSR7aXB9OiR7cG9ydH1gKTtcclxuICAgICAgICAkKCcjY3JlYXRvci1vdXRwdXQnKS52YWwoYCR7dXJsfT9gKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBpc0dsb2JhbElQKGlwOiBudW1iZXIpIHtcclxuICAgICAgICByZXR1cm4gISh0b0ludChbMTAsIDAsIDAsIDBdKSA8PSBpcCAmJiBpcCA8PSB0b0ludChbMTAsIDI1NSwgMjU1LCAyNTVdKVxyXG4gICAgICAgICAgICB8fCB0b0ludChbMTI3LCAwLCAwLCAwXSkgPD0gaXAgJiYgaXAgPD0gdG9JbnQoWzEyNywgMjU1LCAyNTUsIDI1NV0pXHJcbiAgICAgICAgICAgIHx8IHRvSW50KFsxNjksIDI1NCwgMCwgMF0pIDw9IGlwICYmIGlwIDw9IHRvSW50KFsxNjksIDI1NCwgMjU1LCAyNTVdKVxyXG4gICAgICAgICAgICB8fCB0b0ludChbMTcyLCAxNiwgMCwgMF0pIDw9IGlwICYmIGlwIDw9IHRvSW50KFsxNzIsIDMxLCAyNTUsIDI1NV0pXHJcbiAgICAgICAgICAgIHx8IHRvSW50KFsxOTIsIDE2OCwgMCwgMF0pIDw9IGlwICYmIGlwIDw9IHRvSW50KFsxOTIsIDE2OCwgMjU1LCAyNTVdKVxyXG4gICAgICAgICAgICB8fCB0b0ludChbMjI0LCAwLCAwLCAwXSkgPD0gaXApO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGlzSVB2NChpcDogc3RyaW5nKSB7XHJcbiAgICAgICAgcmV0dXJuIGlwLm1hdGNoKC9bMC05XStcXC5bMC05XStcXC5bMC05XStcXC5bMC05XSsvKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiB0b0ludChpcEFycmF5OiBudW1iZXJbXSkge1xyXG4gICAgICAgIHJldHVybiBpcEFycmF5WzBdICogMHgxMDAwMDAwXHJcbiAgICAgICAgICAgICsgaXBBcnJheVsxXSAqIDB4MTAwMDBcclxuICAgICAgICAgICAgKyBpcEFycmF5WzJdICogMHgxMDBcclxuICAgICAgICAgICAgKyBpcEFycmF5WzNdO1xyXG4gICAgfVxyXG59XHJcblxyXG5uYW1lc3BhY2Ugc2V0dGluZyB7XHJcbiAgICBleHBvcnQgZnVuY3Rpb24gc2hvdyhwYXJhbXM6IENoYW5uZWwpIHtcclxuICAgICAgICAkKCcjc2V0dGluZycpLnNob3coKTtcclxuICAgICAgICAkKCcjc2V0dGluZy1idXR0b24nKS5jbGljayhmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJCgnI3NldHRpbmctaW5mbycpLnNob3coKTtcclxuICAgICAgICAgICAgbGV0IGlwID0gJCgnI3NldHRpbmctaXAnKS52YWwoKTtcclxuICAgICAgICAgICAgbGV0IHBvcnQgPSBOdW1iZXIucGFyc2VJbnQoJCgnI3NldHRpbmctcG9ydCcpLnZhbCgpKTtcclxuICAgICAgICAgICAgQ29va2llcy5zZXQoJ2lwJywgaXApO1xyXG4gICAgICAgICAgICBDb29raWVzLnNldCgncG9ydCcsIHBvcnQpO1xyXG4gICAgICAgICAgICByZWRpcmVjdChpcCwgcG9ydCwgcGFyYW1zLmlkLCBwYXJhbXMudGlwKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxyXG5cclxubmFtZXNwYWNlIGV2ZXJ5VGltZSB7XHJcbiAgICBleHBvcnQgZnVuY3Rpb24gc2hvdyhjb29raWU6IENvb2tpZSwgcGFyYW1zOiBDaGFubmVsKSB7XHJcbiAgICAgICAgcmVkaXJlY3QoY29va2llLmlwLCBjb29raWUucG9ydCwgcGFyYW1zLmlkLCBwYXJhbXMudGlwKTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gcmVkaXJlY3QoaXA6IHN0cmluZywgcG9ydDogbnVtYmVyLCBpZDogc3RyaW5nLCB0aXA6IHN0cmluZykge1xyXG4gICAgQ29va2llcy5zZXQoJ2xhdGVzdCcsIEpTT04uc3RyaW5naWZ5KHsgaWQ6IGlkLCB0aXA6IHRpcCwgZGF0ZTogRGF0ZS5ub3coKSB9KSk7XHJcbiAgICBsZXQgdXJsID0gYGh0dHA6Ly8ke2lwfToke3BvcnR9L3Bscy8ke2lkfT90aXA9JHt0aXB9YDtcclxuICAgICQoJy5saW5rJykuYXR0cignaHJlZicsIHVybCk7XHJcbiAgICAkKCcjaWZyYW1lJykuYXR0cignc3JjJywgdXJsKTtcclxufVxyXG5cclxuZnVuY3Rpb24gcGFyc2Uoc2VhcmNoOiBzdHJpbmcpIHtcclxuICAgIGxldCBwYXJhbXM6IGFueSA9IHt9O1xyXG4gICAgc2VhcmNoLnNsaWNlKDEpXHJcbiAgICAgICAgLnNwbGl0KCcmJylcclxuICAgICAgICAubWFwKHggPT4geC5zcGxpdCgnPScpKVxyXG4gICAgICAgIC5mb3JFYWNoKHggPT4ge1xyXG4gICAgICAgICAgICBwYXJhbXNbZGVjb2RlVVJJQ29tcG9uZW50KHhbMF0pXSA9IGRlY29kZVVSSUNvbXBvbmVudCh4WzFdKTtcclxuICAgICAgICB9KTtcclxuICAgIHJldHVybiBwYXJhbXM7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldENvb2tpZSgpIHtcclxuICAgIHJldHVybiA8Q29va2llPntcclxuICAgICAgICBpcDogQ29va2llcy5nZXQoJ2lwJyksXHJcbiAgICAgICAgcG9ydDogTnVtYmVyLnBhcnNlSW50KENvb2tpZXMuZ2V0KCdwb3J0JykpLFxyXG4gICAgICAgIGxhdGVzdDogcGFyc2VMYXRlc3QoQ29va2llcy5nZXQoJ2xhdGVzdCcpKVxyXG4gICAgfTtcclxufVxyXG5cclxuZnVuY3Rpb24gcGFyc2VMYXRlc3QobGF0ZXN0OiBzdHJpbmcpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgcmV0dXJuIDxMYXRlc3Q+SlNPTi5wYXJzZShsYXRlc3QpO1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG59XHJcblxyXG5uYW1lc3BhY2UgYmFzZTY0IHtcclxuICAgIGNvbnN0IHRhYmxlU3RyID0gXCJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvXCI7XHJcbiAgICBjb25zdCB0YWJsZSA9IHRhYmxlU3RyLnNwbGl0KFwiXCIpO1xyXG5cclxuICAgIGZ1bmN0aW9uIGF0b2IoYmFzZTY0OiBzdHJpbmcpIHtcclxuICAgICAgICBpZiAoLyg9W149XSt8PXszLH0pJC8udGVzdChiYXNlNjQpKSB0aHJvdyBuZXcgRXJyb3IoXCJTdHJpbmcgY29udGFpbnMgYW4gaW52YWxpZCBjaGFyYWN0ZXJcIik7XHJcbiAgICAgICAgYmFzZTY0ID0gYmFzZTY0LnJlcGxhY2UoLz0vZywgXCJcIik7XHJcbiAgICAgICAgdmFyIG4gPSBiYXNlNjQubGVuZ3RoICYgMztcclxuICAgICAgICBpZiAobiA9PT0gMSkgdGhyb3cgbmV3IEVycm9yKFwiU3RyaW5nIGNvbnRhaW5zIGFuIGludmFsaWQgY2hhcmFjdGVyXCIpO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBqID0gMCwgbGVuID0gYmFzZTY0Lmxlbmd0aCAvIDQsIGJpbjogbnVtYmVyW10gPSBbXTsgaSA8IGxlbjsgKytpKSB7XHJcbiAgICAgICAgICAgIHZhciBhID0gdGFibGVTdHIuaW5kZXhPZihiYXNlNjRbaisrXSB8fCBcIkFcIiksIGIgPSB0YWJsZVN0ci5pbmRleE9mKGJhc2U2NFtqKytdIHx8IFwiQVwiKTtcclxuICAgICAgICAgICAgdmFyIGMgPSB0YWJsZVN0ci5pbmRleE9mKGJhc2U2NFtqKytdIHx8IFwiQVwiKSwgZCA9IHRhYmxlU3RyLmluZGV4T2YoYmFzZTY0W2orK10gfHwgXCJBXCIpO1xyXG4gICAgICAgICAgICBpZiAoKGEgfCBiIHwgYyB8IGQpIDwgMCkgdGhyb3cgbmV3IEVycm9yKFwiU3RyaW5nIGNvbnRhaW5zIGFuIGludmFsaWQgY2hhcmFjdGVyXCIpO1xyXG4gICAgICAgICAgICBiaW5bYmluLmxlbmd0aF0gPSAoKGEgPDwgMikgfCAoYiA+PiA0KSkgJiAyNTU7XHJcbiAgICAgICAgICAgIGJpbltiaW4ubGVuZ3RoXSA9ICgoYiA8PCA0KSB8IChjID4+IDIpKSAmIDI1NTtcclxuICAgICAgICAgICAgYmluW2Jpbi5sZW5ndGhdID0gKChjIDw8IDYpIHwgZCkgJiAyNTU7XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBiaW4pLnN1YnN0cigwLCBiaW4ubGVuZ3RoICsgbiAtIDQpO1xyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbiBidG9hKGJpbjogc3RyaW5nKSB7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGogPSAwLCBsZW4gPSBiaW4ubGVuZ3RoIC8gMywgYmFzZTY0OiBzdHJpbmdbXSA9IFtdOyBpIDwgbGVuOyArK2kpIHtcclxuICAgICAgICAgICAgdmFyIGEgPSBiaW4uY2hhckNvZGVBdChqKyspLCBiID0gYmluLmNoYXJDb2RlQXQoaisrKSwgYyA9IGJpbi5jaGFyQ29kZUF0KGorKyk7XHJcbiAgICAgICAgICAgIGlmICgoYSB8IGIgfCBjKSA+IDI1NSkgdGhyb3cgbmV3IEVycm9yKFwiU3RyaW5nIGNvbnRhaW5zIGFuIGludmFsaWQgY2hhcmFjdGVyXCIpO1xyXG4gICAgICAgICAgICBiYXNlNjRbYmFzZTY0Lmxlbmd0aF0gPSB0YWJsZVthID4+IDJdICsgdGFibGVbKChhIDw8IDQpICYgNjMpIHwgKGIgPj4gNCldICtcclxuICAgICAgICAgICAgKGlzTmFOKGIpID8gXCI9XCIgOiB0YWJsZVsoKGIgPDwgMikgJiA2MykgfCAoYyA+PiA2KV0pICtcclxuICAgICAgICAgICAgKGlzTmFOKGIgKyBjKSA/IFwiPVwiIDogdGFibGVbYyAmIDYzXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBiYXNlNjQuam9pbihcIlwiKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGhleFRvQmFzZTY0KHN0cjogc3RyaW5nKSB7XHJcbiAgICAgICAgcmV0dXJuIGJ0b2EoU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLFxyXG4gICAgICAgICAgICBzdHIucmVwbGFjZSgvXFxyfFxcbi9nLCBcIlwiKS5yZXBsYWNlKC8oW1xcZGEtZkEtRl17Mn0pID8vZywgXCIweCQxIFwiKS5yZXBsYWNlKC8gKyQvLCBcIlwiKS5zcGxpdChcIiBcIikpXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgZnVuY3Rpb24gYmFzZTY0VG9IZXgoc3RyOiBzdHJpbmcpIHtcclxuICAgICAgICBmb3IgKHZhciBpID0gMCwgYmluID0gYXRvYihzdHIucmVwbGFjZSgvWyBcXHJcXG5dKyQvLCBcIlwiKSksIGhleDogc3RyaW5nW10gPSBbXTsgaSA8IGJpbi5sZW5ndGg7ICsraSkge1xyXG4gICAgICAgICAgICB2YXIgdG1wID0gYmluLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTYpO1xyXG4gICAgICAgICAgICBpZiAodG1wLmxlbmd0aCA9PT0gMSkgdG1wID0gXCIwXCIgKyB0bXA7XHJcbiAgICAgICAgICAgIGhleFtoZXgubGVuZ3RoXSA9IHRtcDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGhleC5qb2luKFwiIFwiKTtcclxuICAgIH1cclxufVxyXG5cclxubWFpbigpO1xyXG4iXX0=
